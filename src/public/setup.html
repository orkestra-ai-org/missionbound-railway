<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Molt Setup</title>
  <link rel="stylesheet" href="/setup/styles.css" />
</head>
<body>
  <div class="wizard-container">
    <!-- Progress Stepper -->
    <div class="stepper" role="navigation" aria-label="Setup progress">
      <div class="step-item active" data-step="1">
        <div class="step-circle">
          <span class="step-number">1</span>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
        <div class="step-label">Welcome</div>
      </div>
      <div class="step-line"></div>
      <div class="step-item" data-step="2">
        <div class="step-circle">
          <span class="step-number">2</span>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
        <div class="step-label">Auth</div>
      </div>
      <div class="step-line"></div>
      <div class="step-item" data-step="3">
        <div class="step-circle">
          <span class="step-number">3</span>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
        <div class="step-label">Channels</div>
      </div>
      <div class="step-line"></div>
      <div class="step-item" data-step="4">
        <div class="step-circle">
          <span class="step-number">4</span>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
        <div class="step-label">Review</div>
      </div>
      <div class="step-line"></div>
      <div class="step-item" data-step="5">
        <div class="step-circle">
          <span class="step-number">5</span>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
        <div class="step-label">Complete</div>
      </div>
    </div>

    <!-- Step 1: Welcome -->
    <section class="step-content active" id="step1" data-step="1" role="tabpanel" aria-labelledby="step1-title">
      <div class="card welcome-card">
        <div class="welcome-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
          </svg>
        </div>
        <h1 id="step1-title">Welcome to Molt</h1>
        <p class="lead">
          This wizard will guide you through configuring Molt, your AI coding assistant platform.
        </p>
        <p class="muted">
          Molt helps you build software faster with AI-powered code generation, debugging, and project management.
        </p>

        <div class="feature-list">
          <div class="feature-item">
            <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
            </svg>
            <div>
              <strong>AI-Powered Coding</strong>
              <p class="muted">Generate, refactor, and debug code with advanced AI models</p>
            </div>
          </div>
          <div class="feature-item">
            <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <div>
              <strong>Messaging Integration</strong>
              <p class="muted">Connect Telegram, Discord, or Slack for seamless interaction</p>
            </div>
          </div>
          <div class="feature-item">
            <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
            <div>
              <strong>Secure & Private</strong>
              <p class="muted">Your API keys and workspace data stay on your server</p>
            </div>
          </div>
        </div>

        <div class="info-box">
          <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
          <div>
            <strong>What you'll need</strong>
            <ul class="muted">
              <li>An API key from your preferred AI provider (e.g., Anthropic, OpenAI, Google)</li>
              <li>Optional: Bot tokens for messaging channels (can be added later)</li>
            </ul>
          </div>
        </div>

        <p class="text-center" style="margin-top: 2rem;">
          <button id="step1-next" class="btn-large">Get Started</button>
        </p>
      </div>
    </section>

    <!-- Step 2: Auth Configuration -->
    <section class="step-content" id="step2" data-step="2" role="tabpanel" aria-labelledby="step2-title" hidden>
      <div class="card">
        <h2 id="step2-title">Configure Authentication</h2>
        <p class="muted">Select your AI provider and enter your API credentials.</p>

        <label for="authGroup">
          Provider Group
          <span class="required">*</span>
        </label>
        <select id="authGroup" required aria-required="true">
          <option value="">Loading providers...</option>
        </select>

        <label for="authChoice">
          Auth Method
          <span class="required">*</span>
        </label>
        <select id="authChoice" required aria-required="true">
          <option value="">Select provider group first</option>
        </select>

        <div class="input-with-toggle">
          <label for="authSecret" class="flex-label">
            <span>
              API Key / Token
              <span class="required">*</span>
            </span>
            <span class="hint">if required by provider</span>
          </label>
          <div class="password-input-wrapper">
            <input
              id="authSecret"
              type="password"
              placeholder="Paste your API key or token"
              autocomplete="off"
              aria-describedby="authSecret-hint"
            />
            <button
              type="button"
              id="authSecret-toggle"
              class="visibility-toggle"
              aria-label="Show password"
              aria-pressed="false"
            >
              <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              <svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" hidden>
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
            </button>
          </div>
          <span id="authSecret-hint" class="hint-text">Your API key is stored securely and never shared.</span>
        </div>

        <label for="flow">
          Wizard Flow
          <span class="badge">Recommended</span>
        </label>
        <select id="flow">
          <option value="quickstart">Quickstart - Essential configuration only</option>
          <option value="advanced">Advanced - More customization options</option>
          <option value="manual">Manual - Full control over setup</option>
        </select>
        <span class="hint-text">Choose how detailed you want the configuration process to be.</span>

        <div id="step2-error" class="error-message" role="alert" aria-live="polite" hidden></div>
      </div>
    </section>

    <!-- Step 3: Channels (Optional) -->
    <section class="step-content" id="step3" data-step="3" role="tabpanel" aria-labelledby="step3-title" hidden>
      <div class="card">
        <h2 id="step3-title">Configure Messaging Channels <span class="optional-text">(Optional)</span></h2>
        <p class="muted">Connect messaging platforms to interact with Openclaw. You can add these later too.</p>

        <div class="accordion">
          <!-- Telegram -->
          <div class="accordion-item">
            <button class="accordion-header" aria-expanded="false" aria-controls="telegram-content">
              <svg class="channel-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 0 0-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/>
              </svg>
              <span>Telegram Bot</span>
              <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div id="telegram-content" class="accordion-content" hidden>
              <label for="telegramToken">Bot Token</label>
              <input id="telegramToken" type="password" placeholder="YOUR_BOT_TOKEN_HERE" autocomplete="off" />
              <div class="help-text">
                <strong>How to get your token:</strong>
                <ol>
                  <li>Open Telegram and message <code>@BotFather</code></li>
                  <li>Send <code>/newbot</code> and follow the prompts</li>
                  <li>Copy the token BotFather provides</li>
                </ol>
              </div>
            </div>
          </div>

          <!-- Discord -->
          <div class="accordion-item">
            <button class="accordion-header" aria-expanded="false" aria-controls="discord-content">
              <svg class="channel-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/>
              </svg>
              <span>Discord Bot</span>
              <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div id="discord-content" class="accordion-content" hidden>
              <label for="discordToken">Bot Token</label>
              <input id="discordToken" type="password" placeholder="YOUR_DISCORD_BOT_TOKEN_HERE" autocomplete="off" />
              <div class="help-text">
                <strong>How to get your token:</strong>
                <ol>
                  <li>Go to <a href="https://discord.com/developers/applications" target="_blank" rel="noopener">Discord Developer Portal</a></li>
                  <li>Create an application and add a Bot</li>
                  <li>Copy the Bot Token</li>
                  <li><strong>Important:</strong> Enable <strong>MESSAGE CONTENT INTENT</strong> in Bot → Privileged Gateway Intents</li>
                </ol>
              </div>
            </div>
          </div>

          <!-- Slack -->
          <div class="accordion-item">
            <button class="accordion-header" aria-expanded="false" aria-controls="slack-content">
              <svg class="channel-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"/>
              </svg>
              <span>Slack Bot</span>
              <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div id="slack-content" class="accordion-content" hidden>
              <label for="slackBotToken">Bot Token</label>
              <input id="slackBotToken" type="password" placeholder="xoxb-YOUR-SLACK-BOT-TOKEN-HERE" autocomplete="off" />

              <label for="slackAppToken">App Token</label>
              <input id="slackAppToken" type="password" placeholder="xapp-1-YOUR-SLACK-APP-TOKEN-HERE" autocomplete="off" />
              <div class="help-text">
                <strong>How to get your tokens:</strong>
                <ol>
                  <li>Go to <a href="https://api.slack.com/apps" target="_blank" rel="noopener">Slack API</a> and create a new app</li>
                  <li>Add a Bot user and install the app to your workspace</li>
                  <li>Copy the Bot Token from "OAuth & Permissions"</li>
                  <li>Enable Socket Mode and copy the App Token from "Basic Information"</li>
                </ol>
              </div>
            </div>
          </div>
        </div>

        <p class="text-center muted" style="margin-top: 1.5rem;">
          You can configure channels anytime from within Openclaw
        </p>
      </div>
    </section>

    <!-- Step 4: Review -->
    <section class="step-content" id="step4" data-step="4" role="tabpanel" aria-labelledby="step4-title" hidden>
      <div class="card">
        <h2 id="step4-title">Review Configuration</h2>
        <p class="muted">Please review your settings before running setup.</p>

        <div class="review-section">
          <h3>Authentication</h3>
          <div class="review-item">
            <span class="review-label">Provider Group:</span>
            <span class="review-value" id="review-authGroup">-</span>
          </div>
          <div class="review-item">
            <span class="review-label">Auth Method:</span>
            <span class="review-value" id="review-authChoice">-</span>
          </div>
          <div class="review-item">
            <span class="review-label">API Key:</span>
            <span class="review-value masked" id="review-authSecret">Not set</span>
          </div>
          <div class="review-item">
            <span class="review-label">Flow:</span>
            <span class="review-value" id="review-flow">-</span>
          </div>
        </div>

        <div class="review-section">
          <h3>Channels</h3>
          <div class="review-item">
            <span class="review-label">Telegram:</span>
            <span class="review-value" id="review-telegram">Not configured</span>
          </div>
          <div class="review-item">
            <span class="review-label">Discord:</span>
            <span class="review-value" id="review-discord">Not configured</span>
          </div>
          <div class="review-item">
            <span class="review-label">Slack:</span>
            <span class="review-value" id="review-slack">Not configured</span>
          </div>
        </div>

        <div class="warning-box">
          <svg class="warning-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
          <div>
            <strong>Important</strong>
            <p class="muted">This will create a configuration file and start the Molt gateway. This action cannot be easily undone.</p>
          </div>
        </div>

        <label class="checkbox-label">
          <input type="checkbox" id="confirmSetup" />
          <span>I confirm the settings above are correct</span>
        </label>

        <div id="step4-error" class="error-message" role="alert" aria-live="polite" hidden></div>
      </div>
    </section>

    <!-- Step 5: Progress/Complete -->
    <section class="step-content" id="step5" data-step="5" role="tabpanel" aria-labelledby="step5-title" hidden>
      <div class="card completion-card">
        <div id="progress-container" class="progress-container" hidden>
          <h2 id="step5-title">Setting up Molt...</h2>
          <p class="muted">This may take a minute or two.</p>

          <div class="progress-bar-wrapper">
            <div class="progress-bar">
              <div id="progress-fill" class="progress-fill" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <span id="progress-text" class="progress-text">0%</span>
          </div>

          <div class="log-container">
            <pre id="log" aria-live="polite"></pre>
          </div>
        </div>

        <div id="success-container" class="success-container" hidden>
          <div class="success-animation">
            <svg class="success-checkmark" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
              <path class="checkmark-circle" d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline class="checkmark-check" points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
          </div>
          <h2>Setup Complete!</h2>
          <p class="lead">Molt is now configured and running.</p>

          <div class="next-steps">
            <h3>What's Next?</h3>
            <div class="step-card">
              <div class="step-number">1</div>
              <div>
                <strong>Open the Molt UI</strong>
                <p class="muted">Access the control panel to manage your workspace and settings</p>
              </div>
            </div>
            <div class="step-card">
              <div class="step-number">2</div>
              <div>
                <strong>Start coding with AI</strong>
                <p class="muted">Create your first project or start chatting with the assistant</p>
              </div>
            </div>
            <div class="step-card">
              <div class="step-number">3</div>
              <div>
                <strong>Configure channels (optional)</strong>
                <p class="muted">Add Telegram, Discord, or Slack for messaging integration</p>
              </div>
            </div>
          </div>

          <div class="action-buttons">
            <a href="/openclaw" target="_blank" class="btn-large btn-primary">Open Molt UI</a>
            <button id="download-backup" class="btn-large btn-secondary">Download Backup</button>
          </div>

          <div class="help-links">
            <a href="https://github.com/openclaw/openclaw" target="_blank" rel="noopener">Documentation</a>
            <span class="separator">•</span>
            <a href="https://github.com/openclaw/openclaw/issues" target="_blank" rel="noopener">Report Issues</a>
          </div>
        </div>

        <div id="error-container" class="error-container" hidden>
          <div class="error-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="15" y1="9" x2="9" y2="15"></line>
              <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
          </div>
          <h2>Setup Failed</h2>
          <p class="muted">There was an error during setup. Please check the details below.</p>

          <div class="log-container">
            <pre id="error-log" aria-live="polite"></pre>
          </div>

          <div class="action-buttons">
            <button id="retry-setup" class="btn-large">Try Again</button>
            <button id="reset-setup" class="btn-large btn-secondary">Reset Configuration</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Status Indicator (shown when already configured) -->
    <div id="configured-banner" class="configured-banner" hidden>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
      <span id="status-text">Molt is already configured</span>
      <span class="separator">|</span>
      <a href="/openclaw" target="_blank">Open UI</a>
      <span class="separator">|</span>
      <a href="/setup/export" target="_blank">Download Backup</a>
      <span class="separator">|</span>
      <button id="reset-from-banner" class="link-button">Reset</button>
    </div>

    <!-- Navigation Footer -->
    <div class="nav-footer" role="navigation" aria-label="Wizard navigation">
      <button id="nav-back" class="btn-secondary" disabled>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        Back
      </button>
      <button id="nav-next" class="btn-primary">
        Next
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>
  </div>

  <script src="/setup/app.js"></script>
</body>
</html>
